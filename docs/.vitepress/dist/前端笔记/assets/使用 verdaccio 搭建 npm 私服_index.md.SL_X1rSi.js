import{_ as s,o as n,c as a,R as p}from"./chunks/framework.rSPAVkc7.js";const e="/fe-blog/assets/1.4mTKiZzQ.png",l="/fe-blog/assets/2._jBR8f7l.png",f=JSON.parse('{"title":"使用 verdaccio 搭建 npm 私服","description":"","frontmatter":{},"headers":[],"relativePath":"使用 verdaccio 搭建 npm 私服/index.md","filePath":"使用 verdaccio 搭建 npm 私服/index.md"}'),i={name:"使用 verdaccio 搭建 npm 私服/index.md"},t=p(`<h1 id="使用-verdaccio-搭建-npm-私服" tabindex="-1">使用 verdaccio 搭建 npm 私服 <a class="header-anchor" href="#使用-verdaccio-搭建-npm-私服" aria-label="Permalink to &quot;使用 verdaccio 搭建 npm 私服&quot;">​</a></h1><h2 id="安装-verdaccio" tabindex="-1">安装 verdaccio <a class="header-anchor" href="#安装-verdaccio" aria-label="Permalink to &quot;安装 verdaccio&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>npm i verdaccio -g</span></span></code></pre></div><h2 id="启动-verdaccio" tabindex="-1">启动 verdaccio <a class="header-anchor" href="#启动-verdaccio" aria-label="Permalink to &quot;启动 verdaccio&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span># 直接启动</span></span>
<span class="line"><span>verdaccio</span></span>
<span class="line"><span># 通过 pm2 启动</span></span>
<span class="line"><span>pm2 start verdaccio</span></span></code></pre></div><p>Verdaccio 启动成功如下： <img src="`+e+'" alt=""><img src="'+l+`" alt=""></p><h2 id="verdaccio-配置文件" tabindex="-1">verdaccio 配置文件 <a class="header-anchor" href="#verdaccio-配置文件" aria-label="Permalink to &quot;verdaccio 配置文件&quot;">​</a></h2><p>可配置权限访问，端口号等 <a href="https://verdaccio.org/docs/configuration" target="_blank" rel="noreferrer">https://verdaccio.org/docs/configuration</a> config.yaml</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>#</span></span>
<span class="line"><span># This is the default configuration file. It allows all users to do anything,</span></span>
<span class="line"><span># please read carefully the documentation and best practices to</span></span>
<span class="line"><span># improve security.</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># Look here for more config file examples:</span></span>
<span class="line"><span># https://github.com/verdaccio/verdaccio/tree/5.x/conf</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># Read about the best practices</span></span>
<span class="line"><span># https://verdaccio.org/docs/best</span></span>
<span class="line"><span></span></span>
<span class="line"><span># path to a directory with all packages</span></span>
<span class="line"><span>storage: /Users/jiajunzeng/.local/share/verdaccio/storage</span></span>
<span class="line"><span># path to a directory with plugins to include</span></span>
<span class="line"><span>plugins: ./plugins</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/webui</span></span>
<span class="line"><span>web:</span></span>
<span class="line"><span>  title: Verdaccio</span></span>
<span class="line"><span>  # comment out to disable gravatar support</span></span>
<span class="line"><span>  # gravatar: false</span></span>
<span class="line"><span>  # by default packages are ordercer ascendant (asc|desc)</span></span>
<span class="line"><span>  # sort_packages: asc</span></span>
<span class="line"><span>  # convert your UI to the dark side</span></span>
<span class="line"><span>  # darkMode: true</span></span>
<span class="line"><span>  # html_cache: true</span></span>
<span class="line"><span>  # by default all features are displayed</span></span>
<span class="line"><span>  # login: true</span></span>
<span class="line"><span>  # showInfo: true</span></span>
<span class="line"><span>  # showSettings: true</span></span>
<span class="line"><span>  # In combination with darkMode you can force specific theme</span></span>
<span class="line"><span>  # showThemeSwitch: true</span></span>
<span class="line"><span>  # showFooter: true</span></span>
<span class="line"><span>  # showSearch: true</span></span>
<span class="line"><span>  # showRaw: true</span></span>
<span class="line"><span>  # showDownloadTarball: true</span></span>
<span class="line"><span>  #  HTML tags injected after manifest &lt;scripts/&gt;</span></span>
<span class="line"><span>  # scriptsBodyAfter:</span></span>
<span class="line"><span>  #    - &#39;&lt;script type=&quot;text/javascript&quot; src=&quot;https://my.company.com/customJS.min.js&quot;&gt;&lt;/script&gt;&#39;</span></span>
<span class="line"><span>  #  HTML tags injected before ends &lt;/head&gt;</span></span>
<span class="line"><span>  #  metaScripts:</span></span>
<span class="line"><span>  #    - &#39;&lt;script type=&quot;text/javascript&quot; src=&quot;https://code.jquery.com/jquery-3.5.1.slim.min.js&quot;&gt;&lt;/script&gt;&#39;</span></span>
<span class="line"><span>  #    - &#39;&lt;script type=&quot;text/javascript&quot; src=&quot;https://browser.sentry-cdn.com/5.15.5/bundle.min.js&quot;&gt;&lt;/script&gt;&#39;</span></span>
<span class="line"><span>  #    - &#39;&lt;meta name=&quot;robots&quot; content=&quot;noindex&quot; /&gt;&#39;</span></span>
<span class="line"><span>  #  HTML tags injected first child at &lt;body/&gt;</span></span>
<span class="line"><span>  #  bodyBefore:</span></span>
<span class="line"><span>  #    - &#39;&lt;div id=&quot;myId&quot;&gt;html before webpack scripts&lt;/div&gt;&#39;</span></span>
<span class="line"><span>  #  Public path for template manifest scripts (only manifest)</span></span>
<span class="line"><span>  #  publicPath: http://somedomain.org/</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#authentication</span></span>
<span class="line"><span>auth:</span></span>
<span class="line"><span>  htpasswd:</span></span>
<span class="line"><span>    file: ./htpasswd # 用户信息文件</span></span>
<span class="line"><span>    max_users: 2 # 设置最多用户数量，-1 表示不允许新建用户</span></span>
<span class="line"><span>    # Maximum amount of users allowed to register, defaults to &quot;+inf&quot;.</span></span>
<span class="line"><span>    # You can set this to -1 to disable registration.</span></span>
<span class="line"><span>    # max_users: 1000</span></span>
<span class="line"><span>    # Hash algorithm, possible options are: &quot;bcrypt&quot;, &quot;md5&quot;, &quot;sha1&quot;, &quot;crypt&quot;.</span></span>
<span class="line"><span>    # algorithm: bcrypt # by default is crypt, but is recommended use bcrypt for new installations</span></span>
<span class="line"><span>    # Rounds number for &quot;bcrypt&quot;, will be ignored for other algorithms.</span></span>
<span class="line"><span>    # rounds: 10</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#uplinks</span></span>
<span class="line"><span># a list of other known repositories we can talk to</span></span>
<span class="line"><span>uplinks:</span></span>
<span class="line"><span>  npmjs:</span></span>
<span class="line"><span>    url: https://registry.npm.taobao.org/ # npm 上链地址，如果私服找不到，会从该地址安装包</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Learn how to protect your packages</span></span>
<span class="line"><span># https://verdaccio.org/docs/protect-your-dependencies/</span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#packages</span></span>
<span class="line"><span>packages:</span></span>
<span class="line"><span>  &#39;@*/*&#39;: # 包匹配，可以设置一些自己命名的私有包，如 &#39;private-‘：</span></span>
<span class="line"><span>    # scoped packages</span></span>
<span class="line"><span>    access: $all  # 所有人都可以安装包</span></span>
<span class="line"><span>    publish: $authenticated # 只有认证的账号可以发包</span></span>
<span class="line"><span>    unpublish: admin # 只允许 admin 删除包</span></span>
<span class="line"><span>    proxy: npmjs # 代理，如果找不到包，会从 uplinks-npmjs 安装</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  &#39;**&#39;:</span></span>
<span class="line"><span>    # allow all users (including non-authenticated users) to read and</span></span>
<span class="line"><span>    # publish all packages</span></span>
<span class="line"><span>    #</span></span>
<span class="line"><span>    # you can specify usernames/groupnames (depending on your auth plugin)</span></span>
<span class="line"><span>    # and three keywords: &quot;$all&quot;, &quot;$anonymous&quot;, &quot;$authenticated&quot;</span></span>
<span class="line"><span>    access: $all</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # allow all known users to publish/publish packages</span></span>
<span class="line"><span>    # (anyone can register by default, remember?)</span></span>
<span class="line"><span>    publish: $authenticated</span></span>
<span class="line"><span>    unpublish: admin</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # if package is not available locally, proxy requests to &#39;npmjs&#39; registry</span></span>
<span class="line"><span>    proxy: npmjs</span></span>
<span class="line"><span></span></span>
<span class="line"><span># To improve your security configuration and  avoid dependency confusion</span></span>
<span class="line"><span># consider removing the proxy property for private packages</span></span>
<span class="line"><span># https://verdaccio.org/docs/best#remove-proxy-to-increase-security-at-private-packages</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#server</span></span>
<span class="line"><span># You can specify HTTP/1.1 server keep alive timeout in seconds for incoming connections.</span></span>
<span class="line"><span># A value of 0 makes the http server behave similarly to Node.js versions prior to 8.0.0, which did not have a keep-alive timeout.</span></span>
<span class="line"><span># WORKAROUND: Through given configuration you can workaround following issue https://github.com/verdaccio/verdaccio/issues/301. Set to 0 in case 60 is not enough.</span></span>
<span class="line"><span>server:</span></span>
<span class="line"><span>  keepAliveTimeout: 60</span></span>
<span class="line"><span>  # Allow \`req.ip\` to resolve properly when Verdaccio is behind a proxy or load-balancer</span></span>
<span class="line"><span>  # See: https://expressjs.com/en/guide/behind-proxies.html</span></span>
<span class="line"><span>  # trustProxy: &#39;127.0.0.1&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#offline-publish</span></span>
<span class="line"><span># publish:</span></span>
<span class="line"><span>#   allow_offline: false</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#url-prefix</span></span>
<span class="line"><span># url_prefix: /verdaccio/</span></span>
<span class="line"><span># VERDACCIO_PUBLIC_URL=&#39;https://somedomain.org&#39;;</span></span>
<span class="line"><span># url_prefix: &#39;/my_prefix&#39;</span></span>
<span class="line"><span># // url -&gt; https://somedomain.org/my_prefix/</span></span>
<span class="line"><span># VERDACCIO_PUBLIC_URL=&#39;https://somedomain.org&#39;;</span></span>
<span class="line"><span># url_prefix: &#39;/&#39;</span></span>
<span class="line"><span># // url -&gt; https://somedomain.org/</span></span>
<span class="line"><span># VERDACCIO_PUBLIC_URL=&#39;https://somedomain.org/first_prefix&#39;;</span></span>
<span class="line"><span># url_prefix: &#39;/second_prefix&#39;</span></span>
<span class="line"><span># // url -&gt; https://somedomain.org/second_prefix/&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#security</span></span>
<span class="line"><span># security:</span></span>
<span class="line"><span>#   api:</span></span>
<span class="line"><span>#     legacy: true</span></span>
<span class="line"><span>#     jwt:</span></span>
<span class="line"><span>#       sign:</span></span>
<span class="line"><span>#         expiresIn: 29d</span></span>
<span class="line"><span>#       verify:</span></span>
<span class="line"><span>#         someProp: [value]</span></span>
<span class="line"><span>#    web:</span></span>
<span class="line"><span>#      sign:</span></span>
<span class="line"><span>#        expiresIn: 1h # 1 hour by default</span></span>
<span class="line"><span>#      verify:</span></span>
<span class="line"><span>#         someProp: [value]</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#user-rate-limit</span></span>
<span class="line"><span># userRateLimit:</span></span>
<span class="line"><span>#   windowMs: 50000</span></span>
<span class="line"><span>#   max: 1000</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#max-body-size</span></span>
<span class="line"><span># max_body_size: 10mb</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#listen-port</span></span>
<span class="line"><span>listen: 0.0.0.0:4873 # 网络地址监听</span></span>
<span class="line"><span># listen:</span></span>
<span class="line"><span># - localhost:4873            # default value</span></span>
<span class="line"><span># - http://localhost:4873     # same thing</span></span>
<span class="line"><span># - 0.0.0.0:4873              # listen on all addresses (INADDR_ANY)</span></span>
<span class="line"><span># - https://example.org:4873  # if you want to use https</span></span>
<span class="line"><span># - &quot;[::1]:4873&quot;                # ipv6</span></span>
<span class="line"><span># - unix:/tmp/verdaccio.sock    # unix socket</span></span>
<span class="line"><span></span></span>
<span class="line"><span># The HTTPS configuration is useful if you do not consider use a HTTP Proxy</span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#https</span></span>
<span class="line"><span># https:</span></span>
<span class="line"><span>#   key: ./path/verdaccio-key.pem</span></span>
<span class="line"><span>#   cert: ./path/verdaccio-cert.pem</span></span>
<span class="line"><span>#   ca: ./path/verdaccio-csr.pem</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#proxy</span></span>
<span class="line"><span># http_proxy: http://something.local/</span></span>
<span class="line"><span># https_proxy: https://something.local/</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/configuration#notifications</span></span>
<span class="line"><span># notify:</span></span>
<span class="line"><span>#   method: POST</span></span>
<span class="line"><span>#   headers: [{ &quot;Content-Type&quot;: &quot;application/json&quot; }]</span></span>
<span class="line"><span>#   endpoint: https://usagge.hipchat.com/v2/room/3729485/notification?auth_token=mySecretToken</span></span>
<span class="line"><span>#   content: &#39;{&quot;color&quot;:&quot;green&quot;,&quot;message&quot;:&quot;New package published: * {{ name }}*&quot;,&quot;notify&quot;:true,&quot;message_format&quot;:&quot;text&quot;}&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>middlewares:</span></span>
<span class="line"><span>  audit:</span></span>
<span class="line"><span>    enabled: true</span></span>
<span class="line"><span></span></span>
<span class="line"><span># https://verdaccio.org/docs/logger</span></span>
<span class="line"><span># log settings</span></span>
<span class="line"><span>logs: { type: stdout, format: pretty, level: http }</span></span>
<span class="line"><span>#experiments:</span></span>
<span class="line"><span>#  # support for npm token command</span></span>
<span class="line"><span>#  token: false</span></span>
<span class="line"><span>#  # disable writing body size to logs, read more on ticket 1912</span></span>
<span class="line"><span>#  bytesin_off: false</span></span>
<span class="line"><span>#  # enable tarball URL redirect for hosting tarball with a different server, the tarball_url_redirect can be a template string</span></span>
<span class="line"><span>#  tarball_url_redirect: &#39;https://mycdn.com/verdaccio/\${packageName}/\${filename}&#39;</span></span>
<span class="line"><span>#  # the tarball_url_redirect can be a function, takes packageName and filename and returns the url, when working with a js configuration file</span></span>
<span class="line"><span>#  tarball_url_redirect(packageName, filename) {</span></span>
<span class="line"><span>#    const signedUrl = // generate a signed url</span></span>
<span class="line"><span>#    return signedUrl;</span></span>
<span class="line"><span>#  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span># translate your registry, api i18n not available yet</span></span>
<span class="line"><span># i18n:</span></span>
<span class="line"><span># list of the available translations https://github.com/verdaccio/verdaccio/blob/master/packages/plugins/ui-theme/src/i18n/ABOUT_TRANSLATIONS.md</span></span>
<span class="line"><span>#   web: en-US</span></span></code></pre></div><p>htpasswd</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>admin:vnJA/UiK4DRv6:autocreated 2023-01-30T07:55:09.853Z</span></span>
<span class="line"><span>batar:656gTYGKVn26Y:autocreated 2023-01-30T07:55:27.268Z</span></span></code></pre></div><h2 id="发包流程" tabindex="-1">发包流程 <a class="header-anchor" href="#发包流程" aria-label="Permalink to &quot;发包流程&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>npm config set regisgry ip:port</span></span>
<span class="line"><span>npm adduser # 注册用户，注册成功会直接登录;</span></span>
<span class="line"><span>npm login # 登录用户，已有账号可直接登录</span></span>
<span class="line"><span>npm publish # 发包</span></span>
<span class="line"><span>npm unpublish packagename # 删除包</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 可使用 npm link 做一些包开发调试</span></span></code></pre></div><h2 id="pm2-了解" tabindex="-1">pm2 了解 <a class="header-anchor" href="#pm2-了解" aria-label="Permalink to &quot;pm2 了解&quot;">​</a></h2><p><a href="https://pm2.keymetrics.io/docs/usage/quick-start/" target="_blank" rel="noreferrer">https://pm2.keymetrics.io/docs/usage/quick-start/</a></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span># 启动</span></span>
<span class="line"><span>pm2 start app.js</span></span>
<span class="line"><span># 列表</span></span>
<span class="line"><span>pm2 list</span></span>
<span class="line"><span># 停止</span></span>
<span class="line"><span>pm2 stop process_id</span></span>
<span class="line"><span># 删除</span></span>
<span class="line"><span>pm2 delete process_id</span></span>
<span class="line"><span># 重启</span></span>
<span class="line"><span>pm2 restart process_id</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span># Fork mode</span></span>
<span class="line"><span>pm2 start app.js --name my-api # Name process# Cluster mode</span></span>
<span class="line"><span>pm2 start app.js -i 0        # Will start maximum processes with LB depending on available CPUs</span></span>
<span class="line"><span>pm2 start app.js -i max      # Same as above, but deprecated.</span></span>
<span class="line"><span>pm2 scale app +3             # Scales \`app\` up by 3 workers</span></span>
<span class="line"><span>pm2 scale app 2              # Scales \`app\` up or down to 2 workers total# Listing</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pm2 list               # Display all processes status</span></span>
<span class="line"><span>pm2 jlist              # Print process list in raw JSON</span></span>
<span class="line"><span>pm2 prettylist         # Print process list in beautified JSON</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pm2 describe 0         # Display all information about a specific process</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pm2 monit              # Monitor all processes# Logs</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pm2 logs [--raw]       # Display all processes logs in streaming</span></span>
<span class="line"><span>pm2 flush              # Empty all log files</span></span>
<span class="line"><span>pm2 reloadLogs         # Reload all logs# Actions</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pm2 stop all           # Stop all processes</span></span>
<span class="line"><span>pm2 restart all        # Restart all processes</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pm2 reload all         # Will 0s downtime reload (for NETWORKED apps)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pm2 stop 0             # Stop specific process id</span></span>
<span class="line"><span>pm2 restart 0          # Restart specific process id</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pm2 delete 0           # Will remove process from pm2 list</span></span>
<span class="line"><span>pm2 delete all         # Will remove all processes from pm2 list# Misc</span></span>
<span class="line"><span></span></span>
<span class="line"><span>pm2 reset &lt;process&gt;    # Reset meta data (restarted time...)</span></span>
<span class="line"><span>pm2 updatePM2          # Update in memory pm2</span></span>
<span class="line"><span>pm2 ping               # Ensure pm2 daemon has been launched</span></span>
<span class="line"><span>pm2 sendSignal SIGUSR2 my-app # Send system signal to script</span></span>
<span class="line"><span>pm2 start app.js --no-daemon</span></span>
<span class="line"><span>pm2 start app.js --no-vizion</span></span>
<span class="line"><span>pm2 start app.js --no-autorestart</span></span></code></pre></div>`,17),c=[t];function o(r,d,u,m,h,g){return n(),a("div",null,c)}const b=s(i,[["render",o]]);export{f as __pageData,b as default};
